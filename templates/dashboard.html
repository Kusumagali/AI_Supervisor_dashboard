<!DOCTYPE html>
<html>
<head>
<title>ðŸ“ž Supervisor Dashboard</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<style>
body { font-family: Arial; background: #f4f4f4; padding: 20px; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
th { background: #007bff; color: white; }
.pending { background: #fff3cd; font-weight: bold; color: #856404; }
.resolved { background: #d4edda; font-weight: bold; color: #155724; }
</style>
</head>

<body>
<h1>ðŸ“ž Supervisor Dashboard</h1>

<table>
<thead>
<tr>
<th>ID</th><th>Customer</th><th>Question</th><th>Answer</th><th>Status</th><th>Action</th>
</tr></thead><tbody></tbody></table>

<script>
const tbody = document.querySelector("tbody");
const socket = io();

function addRow(req) {
    let statusColor = req.status;
    let btn = req.status === "pending" ?
        `<input id="ans-${req.id}" placeholder="Answer"><button onclick="sendAnswer('${req.id}')">Submit</button>` : "-";
    let row = document.getElementById(req.id) || document.createElement("tr");
    row.id = req.id;
    row.innerHTML = `
        <td>${req.id}</td>
        <td>${req.customer_id}</td>
        <td>${req.question}</td>
        <td>${req.answer || ""}</td>
        <td class="${statusColor}">${req.status}</td>
        <td>${btn}</td>
    `;
    if(!document.getElementById(req.id)) tbody.appendChild(row);
}

function sendAnswer(id) {
    let ans = document.getElementById("ans-" + id).value;
    fetch("/requests/" + id, {
        method: "PUT", headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ answer: ans })
    });
}

fetch("/get_requests").then(r => r.json()).then(data => data.forEach(addRow));
socket.on("incoming_request", addRow);
socket.on("request_answered", addRow);
</script>
</body>
</html>
